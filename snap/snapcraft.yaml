name: mir-kiosk-apps
version: 0.3.0
summary: Example apps to run with mir-kiosk
description: Example apps to run with mir-kiosk
confinement: strict
grade: devel
base: core18

apps:
  mir-kiosk-app-daemon:
    command: bin/mir-kiosk-app-daemon
    daemon: simple
    plugs:
      - network
      - opengl
      - wayland
    environment:
      XDG_RUNTIME_DIR: $SNAP_DATA/wayland
      __EGL_VENDOR_LIBRARY_DIRS: $SNAP/etc/glvnd/egl_vendor.d:$SNAP/usr/share/glvnd/egl_vendor.d

plugs:
  wayland-socket-dir:
    content: wayland-socket-dir
    interface: content
    target: $SNAP_DATA/wayland
    default-provider: mir-kiosk:wayland-socket-dir

parts:
  qtwayland:
    plugin: nil
    stage-packages:
      - qtwayland5

  qt-examples:
    plugin: nil
    stage-packages:
      - qtdeclarative5-examples
      - qml-module-qtquick-window2 #qtdeclarative5-examples is missing this dep, which is used by various examples
      - qml-module-qt-labs-folderlistmodel #Another missing dep, needed by photosurface
      - qml-module-qtquick-controls #Missing dep, needed by photoviewer
    build-attributes:
     - no-system-libraries
    organize:
      usr/lib/*/qt5/examples/quick/demos: qt-demos
    prime:
     - qt-demos/*/content
     - qt-demos/*/*.qml
     - -qt-demos/calqlatr # Doesn't work well
     - -qt-demos/photosurface #Crashes
     - -qt-demos/maroon
     - qt-demos/photoviewer
     - qt-demos/clocks/clocks
     - qt-demos/rssnews/rssnews
     - qt-demos/samegame/samegame
     - qt-demos/stocqt/stocqt
     - qt-demos/tweetsearch/tweetsearch
     - usr/lib
     - usr/share/X11/xkb
     - usr/share/fonts
     - etc/fonts

  qmldemo:
    plugin: dump
    source: qmldemo
    stage-packages: [qmlscene]
    organize:
      spinning-rect.qml: qml/spinning-rect.qml
      usr/lib/*/qt5/bin/qmlscene: bin/qmlscene
    prime:
     - qml
     - bin/qmlscene
     - usr/lib/libQt*

  qtchooser-config:
    plugin: dump
    source: qtconfig
    organize:
      snappy-qt5.conf: etc/xdg/qtchooser/snappy-qt5.conf

  glue:
    plugin: dump
    source: glue

  app-wrappers:
    plugin: dump
    source: app-wrappers
    prime: [apps]

  inotify-tools:
    plugin: nil
    stage-packages: [inotify-tools]
    prime:
     - usr/bin/inotifywait
     - usr/lib
